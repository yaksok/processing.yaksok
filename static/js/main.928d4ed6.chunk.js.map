{"version":3,"sources":["App.js","index.js","App.module.css"],"names":["codes","drawing","chain","spirograph","multiple_lights","sine_cosine_in_3d","geometries","App","location","useQueryString","queryString","setQueryString","querystring","parse","searchParams","stringify","useSearchParams","setSearchParams","initialExample","example","editorRef","useRef","iframeRef","useState","selectedExample","setSelectedExample","useEffect","editor","current","ace","edit","renderer","setScrollMargin","window","innerHeight","setOptions","selectionStyle","useSoftTabs","highlightActiveLine","showPrintMargin","theme","YaksokMode","require","Mode","getSession","setMode","setValue","execCommand","href","octoColor","bannerColor","className","styles","value","onChange","e","target","onClick","yaksokCode","a","async","compiler","yaksok","JsTargetCompiler","translator","P5JsTranslator","compile","jsCode","srcDoc","getIframeSrcDoc","getValue","then","console","log","srcdoc","id","ref","sandbox","callParser","Parser","callAsts","setup","getCallAst","draw","mousePressed","mouseReleased","keyPressed","keyReleased","code","node","Name","callExpressions","Expressions","push","Call","call","callAst","this","analyzer","visit","write","getFunctionExprFromCall","JsTranslator","count","fireRerender","search","substr","useCallback","history","pushState","state","onpopstate","addEventListener","removeEventListener","ReactDOM","render","document","getElementById","module","exports"],"mappings":"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","file":"static/js/main.928d4ed6.chunk.js","sourcesContent":["import React, {\n    useState,\n    useEffect,\n    useRef,\n    useCallback,\n} from 'react';\nimport querystring from 'querystring';\nimport raw from 'raw.macro';\nimport { IoIosPlayCircle } from 'react-icons/io';\nimport GithubCorner from 'react-github-corner';\nimport * as yaksok from 'yaksok';\n\nimport * as styles from './App.module.css';\n\nconst yaksokPrelude = raw('./processing.yaksok');\nconst codes = {\n    drawing: raw('./examples/drawing.yaksok'),\n    chain: raw('./examples/chain.yaksok'),\n    spirograph: raw('./examples/spirograph.yaksok'),\n    multiple_lights: raw('./examples/multiple_lights.yaksok'),\n    sine_cosine_in_3d: raw('./examples/sine_cosine_in_3d.yaksok'),\n    geometries: raw('./examples/geometries.yaksok'),\n};\n\nfunction App() {\n    const [searchParams, setSearchParams] = useSearchParams(location);\n    const initialExample = searchParams.example || 'drawing';\n    const editorRef = useRef();\n    const iframeRef = useRef();\n    const [selectedExample, setSelectedExample] = useState(initialExample);\n    const changeExample = example => {\n        setSelectedExample(example);\n        setSearchParams({ example });\n    };\n    useEffect(() => {\n        const editor = editorRef.current = ace.edit('editor');\n        editor.renderer.setScrollMargin(10, window.innerHeight);\n        editor.setOptions({\n            selectionStyle: 'text',\n            useSoftTabs: true,\n            highlightActiveLine: false,\n            showPrintMargin: false,\n            theme: 'ace/theme/monokai',\n        });\n        const YaksokMode = ace.require('ace/mode/yaksok').Mode;\n        editor.getSession().setMode(new YaksokMode());\n    }, []);\n    useEffect(() => {\n        if (!searchParams.example) return;\n        if (selectedExample === searchParams.example) return;\n        setSelectedExample(searchParams.example);\n    }, [searchParams.example]);\n    useEffect(() => {\n        const editor = editorRef.current;\n        editor.setValue(codes[selectedExample]);\n        editor.execCommand('gotostart');\n    }, [selectedExample]);\n    const onPlayButtonClick = () => {\n        const editor = editorRef.current;\n        const yaksokCode = editor.getValue();\n        getIframeSrcDoc(yaksokCode).then(({ jsCode, srcDoc }) => {\n            console.log(jsCode);\n            iframeRef.current.srcdoc = srcDoc;\n        });\n    };\n    return <>\n        <GithubCorner\n            href=\"https://github.com/yaksok/processing.yaksok\"\n            octoColor=\"#414242\"\n            bannerColor=\"#fff\"\n        />\n        <div className={styles.header}>\n            <select\n                className={styles.selectExample}\n                value={selectedExample}\n                onChange={e => changeExample(e.target.value)}>\n                <option value=\"drawing\">그리기</option>\n                <option value=\"chain\">무게추</option>\n                <option value=\"spirograph\">스피로그래프</option>\n                <option value=\"multiple_lights\">삼차원 조명</option>\n                <option value=\"sine_cosine_in_3d\">삼차원 사인 코사인</option>\n                <option value=\"geometries\">삼차원 원시 도형들</option>\n            </select>\n            <button\n                className={styles.playButton}\n                onClick={onPlayButtonClick}>\n                <IoIosPlayCircle/>\n            </button>\n        </div>\n        <div id=\"editor\" className={styles.editor}/>\n        <iframe\n            ref={iframeRef}\n            className={styles.result}\n            sandbox=\"allow-scripts allow-pointer-lock allow-same-origin allow-popups allow-forms allow-modals\"\n        />\n    </>;\n}\n\nexport default App;\n\nconst callParser = new yaksok.parser.Parser(['START_CALL']);\nconst callAsts = {\n    setup: getCallAst('준비하기'),\n    draw: getCallAst('그리기'),\n    mousePressed: getCallAst('마우스를 누르면'),\n    mouseReleased: getCallAst('마우스를 놓으면'),\n    keyPressed: getCallAst('키보드를 누르면'),\n    keyReleased: getCallAst('키보드를 놓으면'),\n};\n\nfunction getCallAst(code) {\n    const node = callParser.parse(code);\n    if (node instanceof yaksok.ast.Name) {\n        const callExpressions = new yaksok.ast.Expressions();\n        callExpressions.push(node);\n        return new yaksok.ast.Call(callExpressions);\n    }\n    return node;\n}\n\nclass P5JsTranslator extends yaksok.translator.JsTranslator {\n    async epilogue() {\n        for (const call in callAsts) {\n            const callAst = callAsts[call];\n            try {\n                await this.compiler.analyzer.visit(callAst);\n                this.write(`window.${call} = (...args) => {\n                    window.마우스 = { 위쪽: window.mouseY, 왼쪽: window.mouseX };\n                    window.프레임번호 = frameCount;\n                    ${this.getFunctionExprFromCall(callAst)}(...args);\n                };`);\n            } catch {}\n        }\n    }\n}\n\nasync function getIframeSrcDoc(yaksokCode) {\n    const compiler = new yaksok.compiler.JsTargetCompiler();\n    compiler.translator = new P5JsTranslator();\n    const jsCode = await compiler.compile(yaksokPrelude + yaksokCode);\n    const srcDoc = `\n<!DOCTYPE HTML>\n<html>\n<head>\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.10.2/p5.js\" crossorigin=\"\"></script>\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.10.2/addons/p5.sound.min.js\" crossorigin=\"\"></script>\n    <meta charset=\"utf-8\">\n    <style>\n        html, body {\n            margin: 0;\n            padding: 0;\n        }\n        canvas {\n            display: block;\n        }\n    </style>\n</head>\n<body>\n    <script>\n        ${jsCode}\n    </script>\n</body>\n</html>\n`;\n    return {\n        jsCode,\n        srcDoc,\n    };\n}\n\nfunction useQueryString(location) {\n    const [_, fireRerender] = useState(++useQueryString.count);\n    const queryString = location.search.substr(1);\n    const setQueryString = useCallback(\n        queryString => history.pushState(history.state, '', queryString ? `?${queryString}` : ''),\n        [history],\n    );\n    useEffect(() => {\n        const onpopstate = () => fireRerender(++useQueryString.count);\n        window.addEventListener('popstate', onpopstate);\n        return () => window.removeEventListener(onpopstate);\n    }, []);\n    return [queryString, setQueryString];\n}\nuseQueryString.count = 0;\n\nfunction useSearchParams(location) {\n    const [queryString, setQueryString] = useQueryString(location);\n    const searchParams = querystring.parse(queryString);\n    const setSearchParams = searchParams => setQueryString(querystring.stringify(searchParams));\n    return [searchParams, setSearchParams];\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(<App />, document.getElementById('root'));\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"header\":\"App_header__3ZZ1n\",\"selectExample\":\"App_selectExample__1CUJV\",\"playButton\":\"App_playButton__38Hm1\",\"editor\":\"App_editor__28Gqx\",\"result\":\"App_result__3tsSR\"};"],"sourceRoot":""}